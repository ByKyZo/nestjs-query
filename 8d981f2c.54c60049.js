/*! For license information please see 8d981f2c.54c60049.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{166:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return d})),n.d(t,"default",(function(){return u}));var a=n(1),r=n(6),o=(n(0),n(223)),l=n(228),i=n(227),s={title:"Services"},c={id:"persistence/services",title:"Services",description:"`@nestjs-query` provides a common interface to use difference ORMs inorder to query and mutate your data.",source:"@site/docs/persistence/services.mdx",permalink:"/nestjs-query/docs/persistence/services",editUrl:"https://github.com/doug-martin/nestjs-query/edit/master/documentation/docs/persistence/services.mdx",sidebar:"docs",previous:{title:"Assemblers",permalink:"/nestjs-query/docs/concepts/assemblers"},next:{title:"Getting Started",permalink:"/nestjs-query/docs/persistence/sequelize/getting-started"}},d=[{value:"Creating a Service",id:"creating-a-service",children:[{value:"Decorator",id:"decorator",children:[]},{value:"Module",id:"module",children:[]}]},{value:"Querying",id:"querying",children:[{value:"Filtering",id:"filtering",children:[]},{value:"Sorting",id:"sorting",children:[]},{value:"Paging",id:"paging",children:[]},{value:"Find By Id",id:"find-by-id",children:[]},{value:"Get By Id",id:"get-by-id",children:[]}]},{value:"Creating",id:"creating",children:[{value:"Create One",id:"create-one",children:[]},{value:"Create Many",id:"create-many",children:[]}]},{value:"Updating",id:"updating",children:[{value:"Update One",id:"update-one",children:[]},{value:"Update Many",id:"update-many",children:[]}]},{value:"Deleting",id:"deleting",children:[{value:"Delete One",id:"delete-one",children:[]},{value:"Delete Many",id:"delete-many",children:[]}]},{value:"Foreign Keys",id:"foreign-keys",children:[{value:"Example",id:"example-12",children:[]}]},{value:"Relations",id:"relations",children:[{value:"Example",id:"example-13",children:[]}]}],m={rightToc:d};function u(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},m,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"@nestjs-query")," provides a common interface to use difference ORMs inorder to query and mutate your data."),Object(o.b)("p",null,"The following ORMs are supported out of the box."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"./typeorm/getting-started"}),"TypeOrm")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"./sequelize/getting-started"}),"Sequelize"))),Object(o.b)("p",null,"All examples assume the following entity."),Object(o.b)(l.a,{defaultValue:"typeorm",groupId:"orm",values:[{label:"TypeOrm",value:"typeorm"},{label:"Sequelize",value:"sequelize"}],mdxType:"Tabs"},Object(o.b)(i.a,{value:"typeorm",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="todo-item.entity.ts"',title:'"todo-item.entity.ts"'}),"import { Column, CreateDateColumn, Entity, PrimaryGeneratedColumn, UpdateDateColumn } from 'typeorm';\n\n@Entity()\nexport class TodoItemEntity {\n  @PrimaryGeneratedColumn()\n  id!: string;\n\n  @Column()\n  title!: string;\n\n  @Column()\n  completed!: boolean;\n\n  @CreateDateColumn()\n  created!: Date;\n\n  @UpdateDateColumn()\n  updated!: Date;\n}\n"))),Object(o.b)(i.a,{value:"sequelize",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="todo-item.entity.ts"',title:'"todo-item.entity.ts"'}),"import {\n  Table,\n  Column,\n  Model,\n  AllowNull,\n  CreatedAt,\n  UpdatedAt,\n  PrimaryKey,\n  AutoIncrement,\n} from 'sequelize-typescript';\n\n@Table\nexport class TodoItemEntity extends Model<TodoItemEntity> {\n  @PrimaryKey\n  @AutoIncrement\n  @Column\n  id!: number;\n\n  @Column\n  title!: string;\n\n  @AllowNull\n  @Column\n  description?: string;\n\n  @Column\n  completed!: boolean;\n\n  @CreatedAt\n  created!: Date;\n\n  @UpdatedAt\n  updated!: Date;\n}\n")))),Object(o.b)("h2",{id:"creating-a-service"},"Creating a Service"),Object(o.b)("h3",{id:"decorator"},"Decorator"),Object(o.b)("p",null,"Each persistence package includes a decorator that will automatically create a ",Object(o.b)("inlineCode",{parentName:"p"},"QueryService")," for you to use in your application."),Object(o.b)(l.a,{defaultValue:"typeorm",groupId:"orm",values:[{label:"TypeOrm",value:"typeorm"},{label:"Sequelize",value:"sequelize"}],mdxType:"Tabs"},Object(o.b)(i.a,{value:"typeorm",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="todo-item.resolver.ts" {11}',title:'"todo-item.resolver.ts"',"{11}":!0}),"import { QueryService } from '@nestjs-query/core';\nimport { CRUDResolver } from '@nestjs-query/query-graphql';\nimport { Resolver } from '@nestjs/graphql';\nimport { InjectTypeOrmQueryService } from '@nestjs-query/query-typeorm';\nimport { TodoItemDTO } from './todo-item.dto';\nimport { TodoItemEntity } from './todo-item.entity';\n\n@Resolver(() => TodoItemDTO)\nexport class TodoItemResolver extends CRUDResolver(TodoItemDTO) {\n  constructor(\n    @InjectTypeOrmQueryService(TodoItemEntity) readonly service: QueryService<TodoItemEntity>\n  ) {\n    super(service);\n  }\n}\n"))),Object(o.b)(i.a,{value:"sequelize",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="todo-item.resolver.ts" {11}',title:'"todo-item.resolver.ts"',"{11}":!0}),"import { QueryService } from '@nestjs-query/core';\nimport { CRUDResolver } from '@nestjs-query/query-graphql';\nimport { Resolver } from '@nestjs/graphql';\nimport { InjectSequelizeQueryService } from '@nestjs-query/query-sequelize';\nimport { TodoItemDTO } from './todo-item.dto';\nimport { TodoItemEntity } from './todo-item.entity';\n\n@Resolver(() => TodoItemDTO)\nexport class TodoItemResolver extends CRUDResolver(TodoItemDTO) {\n  constructor(\n    @InjectSequelizeQueryService(TodoItemEntity) readonly service: QueryService<TodoItemEntity>\n  ) {\n    super(service);\n  }\n}\n")))),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"In the above example the DTO and entity are the same shape, if you have a case where they are different or have computed fields check out ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../concepts/assemblers"}),"Assemblers")," to understand how to convert to and from the DTO/Entity."))),Object(o.b)("h3",{id:"module"},"Module"),Object(o.b)("p",null,"In order to use the decorator you will need to use the module that comes with the ",Object(o.b)("inlineCode",{parentName:"p"},"nestjs-query")," orm module."),Object(o.b)(l.a,{defaultValue:"typeorm",groupId:"orm",values:[{label:"TypeOrm",value:"typeorm"},{label:"Sequelize",value:"sequelize"}],mdxType:"Tabs"},Object(o.b)(i.a,{value:"typeorm",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="todo-item.module.ts" {8}',title:'"todo-item.module.ts"',"{8}":!0}),"import { NestjsQueryTypeOrmModule } from '@nestjs-query/query-typeorm';\nimport { Module } from '@nestjs/common';\nimport { TodoItemEntity } from './todo-item.entity';\nimport { TodoItemResolver } from './todo-item.resolver';\n\n@Module({\n  providers: [TodoItemResolver],\n  imports: [NestjsQueryTypeOrmModule.forFeature([TodoItemEntity])],\n})\nexport class TodoItemModule {}\n\n"))),Object(o.b)(i.a,{value:"sequelize",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="todo-item.module.ts" {8}',title:'"todo-item.module.ts"',"{8}":!0}),"import { NestjsQuerySequelizeModule } from '@nestjs-query/query-sequelize';\nimport { Module } from '@nestjs/common';\nimport { TodoItemEntity } from './todo-item.entity';\nimport { TodoItemResolver } from './todo-item.resolver';\n\n@Module({\n  providers: [TodoItemResolver],\n  imports: [NestjsQuerySequelizeModule.forFeature([TodoItemEntity])],\n})\nexport class TodoItemModule {}\n")))),Object(o.b)("h2",{id:"querying"},"Querying"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"nestjs-query")," QueryService uses a common ",Object(o.b)("inlineCode",{parentName:"p"},"Query")," interface that allows you use a common type regardless of the persistence libary in use."),Object(o.b)("p",null," To query for records from your service you can use the ",Object(o.b)("inlineCode",{parentName:"p"},"query")," method which will return a ",Object(o.b)("inlineCode",{parentName:"p"},"Promise")," of an array of entities. To read more about querying take a look at the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../concepts/queries"}),"Queries Doc"),"."),Object(o.b)("h4",{id:"example"},"Example"),Object(o.b)("p",null,"Get all records"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const records = await this.service.query({});\n")),Object(o.b)("h3",{id:"filtering"},"Filtering"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"filter")," option is translated to a ",Object(o.b)("inlineCode",{parentName:"p"},"WHERE")," clause."),Object(o.b)("h4",{id:"example-1"},"Example"),Object(o.b)("p",null,"To find all completed ",Object(o.b)("inlineCode",{parentName:"p"},"TodoItems")," by use can use the ",Object(o.b)("inlineCode",{parentName:"p"},"is")," operator."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const records = await this.service.query({\n   filter : {\n     completed: { is: true },\n   },\n});\n")),Object(o.b)("h3",{id:"sorting"},"Sorting"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"sorting")," option is translated to a ",Object(o.b)("inlineCode",{parentName:"p"},"ORDER BY"),"."),Object(o.b)("h4",{id:"example-2"},"Example"),Object(o.b)("p",null,"Sorting records by ",Object(o.b)("inlineCode",{parentName:"p"},"completed")," and ",Object(o.b)("inlineCode",{parentName:"p"},"title"),"."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const records = await this.service.query({\n  sorting: [\n    {field: 'completed', direction: SortDirection.ASC},\n    {field: 'title', direction: SortDirection.DESC},\n  ],\n});\n")),Object(o.b)("h3",{id:"paging"},"Paging"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"paging")," option is translated to ",Object(o.b)("inlineCode",{parentName:"p"},"LIMIT")," and ",Object(o.b)("inlineCode",{parentName:"p"},"OFFSET"),"."),Object(o.b)("h4",{id:"example-3"},"Example"),Object(o.b)("p",null,"Skip the first 20 records and return the next 10."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const records = await this.service.query({\n  paging: {limit: 10, offset: 20},\n});\n")),Object(o.b)("h3",{id:"find-by-id"},"Find By Id"),Object(o.b)("p",null,"To find a single record you can use the ",Object(o.b)("inlineCode",{parentName:"p"},"findById")," method."),Object(o.b)("h4",{id:"example-4"},"Example"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const records = await this.service.findById(1);\n")),Object(o.b)("h3",{id:"get-by-id"},"Get By Id"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"getById")," method is the same as the ",Object(o.b)("inlineCode",{parentName:"p"},"findById")," with one key difference, it will throw an exception if the record is not found."),Object(o.b)("h4",{id:"example-5"},"Example"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"try {\n  const records = await this.service.getById(1);\n} catch (e) {\n  console.error('Unable to get record with id = 1');\n}\n")),Object(o.b)("h2",{id:"creating"},"Creating"),Object(o.b)("h3",{id:"create-one"},"Create One"),Object(o.b)("p",null,"To create a single record use the ",Object(o.b)("inlineCode",{parentName:"p"},"createOne")," method."),Object(o.b)("h4",{id:"example-6"},"Example"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const createdRecord = await this.service.createOne({\n  title: 'Foo',\n  completed: false,\n});\n")),Object(o.b)("h3",{id:"create-many"},"Create Many"),Object(o.b)("p",null,"To create multiple records use the ",Object(o.b)("inlineCode",{parentName:"p"},"createMany")," method."),Object(o.b)("h4",{id:"example-7"},"Example"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const createdRecords = await this.service.createMany([\n  { title: 'Foo', completed: false },\n  { title: 'Bar', completed: true },\n]);\n")),Object(o.b)("h2",{id:"updating"},"Updating"),Object(o.b)("h3",{id:"update-one"},"Update One"),Object(o.b)("p",null,"To update a single record use the ",Object(o.b)("inlineCode",{parentName:"p"},"updateOne")," method."),Object(o.b)("h4",{id:"example-8"},"Example"),Object(o.b)("p",null,"Updates the record with an id equal to 1 to completed."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const updatedRecord = await this.service.updateOne(1, { completed: true });\n")),Object(o.b)("h3",{id:"update-many"},"Update Many"),Object(o.b)("p",null,"To update multiple records use the ",Object(o.b)("inlineCode",{parentName:"p"},"updateMany")," method."),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"NOTE")," This method returns a ",Object(o.b)("inlineCode",{parentName:"p"},"UpdateManyResponse")," which contains the updated record count."),Object(o.b)("h4",{id:"example-9"},"Example"),Object(o.b)("p",null,"Updates all ",Object(o.b)("inlineCode",{parentName:"p"},"TodoItemEntities")," to completed if their title ends in ",Object(o.b)("inlineCode",{parentName:"p"},"Bar")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const { updatedCount } = await this.service.updateMany(\n  {completed: true}, // update\n  {completed: {is: false}, title: {like: '%Bar'}} // filter\n);\n")),Object(o.b)("h2",{id:"deleting"},"Deleting"),Object(o.b)("h3",{id:"delete-one"},"Delete One"),Object(o.b)("p",null,"To delete a single record use the ",Object(o.b)("inlineCode",{parentName:"p"},"deleteOne")," method."),Object(o.b)("h4",{id:"example-10"},"Example"),Object(o.b)("p",null,"Delete the record with an id equal to 1."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const deletedRecord = await this.service.deleteOne(1);\n")),Object(o.b)("h3",{id:"delete-many"},"Delete Many"),Object(o.b)("p",null,"To delete multiple records use the ",Object(o.b)("inlineCode",{parentName:"p"},"deleteMany")," method."),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"NOTE")," This method returns a ",Object(o.b)("inlineCode",{parentName:"p"},"DeleteManyResponse")," which contains the deleted record count."),Object(o.b)("h4",{id:"example-11"},"Example"),Object(o.b)("p",null,"Delete all ",Object(o.b)("inlineCode",{parentName:"p"},"TodoItemEntities")," older than ",Object(o.b)("inlineCode",{parentName:"p"},"Jan 1, 2019"),"."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const { deletedCount } = await this.service.deleteMany(\n  { created: { lte: new Date('2019-1-1') } } // filter\n);\n")),Object(o.b)("h2",{id:"foreign-keys"},"Foreign Keys"),Object(o.b)("p",null,"It is a common use case to include a foreign key from your entity in your DTO."),Object(o.b)("p",null,"To do this you should add the foreign key to your entity as well as your DTO."),Object(o.b)("h3",{id:"example-12"},"Example"),Object(o.b)("p",null,"Assume TodoItems can have SubTasks we would set up our SubTaskEntity using the following"),Object(o.b)(l.a,{defaultValue:"typeorm",groupId:"orm",values:[{label:"TypeOrm",value:"typeorm"},{label:"Sequelize",value:"sequelize"}],mdxType:"Tabs"},Object(o.b)(i.a,{value:"typeorm",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="sub-task.entity.ts"',title:'"sub-task.entity.ts"'}),"import {\n  Entity,\n  PrimaryGeneratedColumn,\n  Column,\n  CreateDateColumn,\n  UpdateDateColumn,\n  ObjectType,\n  ManyToOne,\n  JoinColumn,\n} from 'typeorm';\nimport { TodoItemEntity } from '../todo-item/todo-item.entity';\n\n@Entity({ name: 'sub_task' })\nexport class SubTaskEntity {\n  @PrimaryGeneratedColumn()\n  id!: number;\n\n  @Column()\n  title!: string;\n\n  @Column({ nullable: true })\n  description?: string;\n\n  @Column()\n  completed!: boolean;\n\n  // add the todoItemId to the model\n  @Column({ nullable: false, name: 'todo_item_id' })\n  todoItemId!: string;\n\n  @ManyToOne((): ObjectType<TodoItemEntity> => TodoItemEntity, (td) => td.subTasks, {\n    onDelete: 'CASCADE',\n    nullable: false,\n  })\n  // specify the join column we want to use.\n  @JoinColumn({ name: 'todo_item_id' })\n  todoItem!: TodoItemEntity;\n\n  @CreateDateColumn()\n  created!: Date;\n\n  @UpdateDateColumn()\n  updated!: Date;\n}\n"))),Object(o.b)(i.a,{value:"sequelize",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="sub-task.entity.ts"',title:'"sub-task.entity.ts"'}),"import {\n  Table,\n  AllowNull,\n  Column,\n  ForeignKey,\n  BelongsTo,\n  CreatedAt,\n  UpdatedAt,\n  Model,\n  AutoIncrement,\n  PrimaryKey,\n} from 'sequelize-typescript';\nimport { TodoItemEntity } from '../todo-item/entity/todo-item.entity';\n\n@Table({})\nexport class SubTaskEntity extends Model<SubTaskEntity> {\n  @PrimaryKey\n  @AutoIncrement\n  @Column\n  id!: number;\n\n  @Column\n  title!: string;\n\n  @AllowNull\n  @Column\n  description?: string;\n\n  @Column\n  completed!: boolean;\n\n  @Column\n  @ForeignKey(() => TodoItemEntity)\n  todoItemId!: number;\n\n  @BelongsTo(() => TodoItemEntity)\n  todoItem!: TodoItemEntity;\n\n  @CreatedAt\n  created!: Date;\n\n  @UpdatedAt\n  updated!: Date;\n}\n")))),Object(o.b)("p",null,"Then we could add the ",Object(o.b)("inlineCode",{parentName:"p"},"todoItemId")," to the SubTaskDTO."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="sub-task.dto.ts" {24-26}',title:'"sub-task.dto.ts"',"{24-26}":!0}),"import { FilterableField } from '@nestjs-query/query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime } from '@nestjs/graphql';\n\n@ObjectType('SubTask')\nexport class SubTaskDTO {\n  @FilterableField(() => ID)\n  id!: number;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField({ nullable: true })\n  description?: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @FilterableField(() => GraphQLISODateTime)\n  created!: Date;\n\n  @FilterableField(() => GraphQLISODateTime)\n  updated!: Date;\n\n  // expose the todoItemId as a filterable field.\n  @FilterableField()\n  todoItemId!: string;\n}\n")),Object(o.b)("h2",{id:"relations"},"Relations"),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"This section only applies when you combine your DTO and entity"))),Object(o.b)("p",null,"When your DTO and entity are the same class and you have relations defined, you should not decorate your the relations in the DTO with ",Object(o.b)("inlineCode",{parentName:"p"},"@Field")," or ",Object(o.b)("inlineCode",{parentName:"p"},"@FilterableField"),"."),Object(o.b)("p",null,"Instead specify the relations you want to expose in your resolver."),Object(o.b)("h3",{id:"example-13"},"Example"),Object(o.b)("p",null,"Assume you have the following subtask definition."),Object(o.b)(l.a,{defaultValue:"typeorm",groupId:"orm",values:[{label:"TypeOrm",value:"typeorm"},{label:"Sequelize",value:"sequelize"}],mdxType:"Tabs"},Object(o.b)(i.a,{value:"typeorm",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="sub-task.ts"  {37-43}',title:'"sub-task.ts"',"":!0,"{37-43}":!0}),"import {\n  Entity,\n  PrimaryGeneratedColumn,\n  Column,\n  CreateDateColumn,\n  UpdateDateColumn,\n  ManyToOne,\n  JoinColumn,\n} from 'typeorm';\nimport { ObjectType, ID } from '@nestjs/graphql';\nimport { FilterableField } from '@nestjs-query/query-graphql';\nimport { TodoItem } from '../todo-item/todo-item';\n\n@ObjectType()\n@Entity({ name: 'sub_task' })\nexport class SubTask {\n  @FilterableField(() => ID)\n  @PrimaryGeneratedColumn()\n  id!: number;\n\n  @FilterableField()\n  @Column()\n  title!: string;\n\n  @FilterableField()\n  @Column({ nullable: true })\n  description?: string;\n\n  @FilterableField()\n  @Column()\n  completed!: boolean;\n\n  @FilterableField()\n  @Column({ nullable: false, name: 'todo_item_id' })\n  todoItemId!: string;\n\n  // do not decorate with @Field\n  @ManyToOne(() => TodoItemEntity, (td) => td.subTasks, {\n    onDelete: 'CASCADE',\n    nullable: false,\n  })\n  @JoinColumn({ name: 'todo_item_id' })\n  todoItem!: TodoItem;\n\n  @FilterableField()\n  @CreateDateColumn()\n  created!: Date;\n\n  @FilterableField()\n  @UpdateDateColumn()\n  updated!: Date;\n}\n"))),Object(o.b)(i.a,{value:"sequelize",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="sub-task.ts" {44-46}',title:'"sub-task.ts"',"{44-46}":!0}),"import {\n  Table,\n  AllowNull,\n  Column,\n  ForeignKey,\n  BelongsTo,\n  CreatedAt,\n  UpdatedAt,\n  Model,\n  AutoIncrement,\n  PrimaryKey,\n} from 'sequelize-typescript';\nimport { FilterableField } from '@nestjs-query/query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime } from '@nestjs/graphql';\nimport { TodoItem } from '../todo-item/entity/todo-item';\n\n@ObjectType()\n@Table\nexport class SubTask extends Model<SubTaskEntity> {\n  @FilterableField(() => ID)\n  @PrimaryKey\n  @AutoIncrement\n  @Column\n  id!: number;\n\n  @FilterableField()\n  @Column\n  title!: string;\n\n  @FilterableField({ nullable: true })\n  @AllowNull\n  @Column\n  description?: string;\n\n  @FilterableField()\n  @Column\n  completed!: boolean;\n\n  @FilterableField()\n  @Column\n  @ForeignKey(() => TodoItemEntity)\n  todoItemId!: number;\n\n  // do not decorate with @Field\n  @BelongsTo(() => TodoItem)\n  todoItem!: TodoItem;\n\n  @FilterableField(() => GraphQLISODateTime)\n  @CreatedAt\n  created!: Date;\n\n  @FilterableField(() => GraphQLISODateTime)\n  @UpdatedAt\n  updated!: Date;\n}\n")))),Object(o.b)("p",null,"Notice how the ",Object(o.b)("inlineCode",{parentName:"p"},"todoItem")," is not decorated with a field decorator."),Object(o.b)("p",null,"Instead, add it to your resolver."),Object(o.b)(l.a,{defaultValue:"typeorm",groupId:"orm",values:[{label:"TypeOrm",value:"typeorm"},{label:"Sequelize",value:"sequelize"}],mdxType:"Tabs"},Object(o.b)(i.a,{value:"typeorm",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:"{11}","{11}":!0}),"import { QueryService } from '@nestjs-query/core';\nimport { CRUDResolver } from '@nestjs-query/query-graphql';\nimport { Resolver } from '@nestjs/graphql';\nimport { InjectTypeOrmQueryService } from '@nestjs-query/query-typeorm';\nimport { TodoItem } from '../todo-item/todo-item';\nimport { SubTask } from './sub-task';\n\n@Resolver(() => SubTask)\nexport class SubTaskResolver extends CRUDResolver(SubTask, {\n  relations: {\n    one: { todoItem: { DTO: TodoItem, disableRemove: true } },\n  },\n}) {\n  constructor(@InjectTypeOrmQueryService(SubTask) readonly service: QueryService<SubTask>) {\n    super(service);\n  }\n}\n"))),Object(o.b)(i.a,{value:"sequelize",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:"{11}","{11}":!0}),"import { QueryService } from '@nestjs-query/core';\nimport { CRUDResolver } from '@nestjs-query/query-graphql';\nimport { Resolver } from '@nestjs/graphql';\nimport { InjectSequelizeQueryService } from '@nestjs-query/query-sequelize';\nimport { TodoItem } from '../todo-item/todo-item';\nimport { SubTask } from './sub-task';\n\n@Resolver(() => SubTask)\nexport class SubTaskResolver extends CRUDResolver(SubTask, {\n  relations: {\n    one: { todoItem: { DTO: TodoItem, disableRemove: true } },\n  },\n}) {\n  constructor(@InjectSequelizeQueryService(SubTask) readonly service: QueryService<SubTask>) {\n    super(service);\n  }\n}\n")))))}u.isMDXComponent=!0},223:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return p}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=r.a.createContext({}),d=function(e){var t=r.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i({},t,{},e)),n},m=function(e){var t=d(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},b=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=d(n),b=a,p=m["".concat(l,".").concat(b)]||m[b]||u[b]||o;return n?r.a.createElement(p,i({ref:t},c,{components:n})):r.a.createElement(p,i({ref:t},c))}));function p(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=b;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var c=2;c<o;c++)l[c]=n[c];return r.a.createElement.apply(null,l)}return r.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"},224:function(e,t,n){var a;!function(){"use strict";var n={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var a=arguments[t];if(a){var o=typeof a;if("string"===o||"number"===o)e.push(a);else if(Array.isArray(a)&&a.length){var l=r.apply(null,a);l&&e.push(l)}else if("object"===o)for(var i in a)n.call(a,i)&&a[i]&&e.push(i)}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(a=function(){return r}.apply(t,[]))||(e.exports=a)}()},225:function(e,t,n){"use strict";var a=n(0);const r=Object(a.createContext)({tabGroupChoices:{},setTabGroupChoices:()=>{}});t.a=r},227:function(e,t,n){"use strict";var a=n(0),r=n.n(a);t.a=function(e){return r.a.createElement("div",null,e.children)}},228:function(e,t,n){"use strict";var a=n(0),r=n.n(a),o=n(225);var l=function(){return Object(a.useContext)(o.a)},i=n(224),s=n.n(i),c=n(93),d=n.n(c);const m=37,u=39;t.a=function(e){const{block:t,children:n,defaultValue:o,values:i,groupId:c}=e,{tabGroupChoices:b,setTabGroupChoices:p}=l(),[y,O]=Object(a.useState)(o);if(null!=c){const e=b[c];null!=e&&e!==y&&O(e)}const j=e=>{O(e),null!=c&&p(c,e)},h=[];return r.a.createElement("div",null,r.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:s()("tabs",{"tabs--block":t})},i.map(({value:e,label:t})=>r.a.createElement("li",{role:"tab",tabIndex:"0","aria-selected":y===e,className:s()("tab-item",d.a.tabItem,{"tab-item--active":y===e}),key:e,ref:e=>h.push(e),onKeyDown:e=>((e,t,n)=>{switch(n.keyCode){case u:((e,t)=>{const n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()})(e,t);break;case m:((e,t)=>{const n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()})(e,t)}})(h,e.target,e),onFocus:()=>j(e),onClick:()=>j(e)},t))),r.a.createElement("div",{role:"tabpanel",className:"margin-vert--md"},a.Children.toArray(n).filter(e=>e.props.value===y)[0]))}}}]);