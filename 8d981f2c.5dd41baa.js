(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{166:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return d})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return m}));var a=n(2),o=n(6),r=(n(0),n(230)),i=n(234),l=n(235),c={title:"Services"},d={id:"persistence/services",isDocsHomePage:!1,title:"Services",description:"@nestjs-query provides a common interface to use difference ORMs inorder to query and mutate your data.",source:"@site/docs/persistence/services.mdx",permalink:"/nestjs-query/docs/persistence/services",editUrl:"https://github.com/doug-martin/nestjs-query/edit/master/documentation/docs/persistence/services.mdx",sidebar:"docs",previous:{title:"Assemblers",permalink:"/nestjs-query/docs/concepts/assemblers"},next:{title:"Getting Started",permalink:"/nestjs-query/docs/persistence/sequelize/getting-started"}},s=[{value:"Creating a Service",id:"creating-a-service",children:[{value:"Module",id:"module",children:[]},{value:"Decorator",id:"decorator",children:[]}]},{value:"Querying",id:"querying",children:[{value:"Filtering",id:"filtering",children:[]},{value:"Sorting",id:"sorting",children:[]},{value:"Paging",id:"paging",children:[]},{value:"Find By Id",id:"find-by-id",children:[]},{value:"Get By Id",id:"get-by-id",children:[]},{value:"Aggregating",id:"aggregating",children:[]}]},{value:"Creating",id:"creating",children:[{value:"Create One",id:"create-one",children:[]},{value:"Create Many",id:"create-many",children:[]}]},{value:"Updating",id:"updating",children:[{value:"Update One",id:"update-one",children:[]},{value:"Update Many",id:"update-many",children:[]}]},{value:"Deleting",id:"deleting",children:[{value:"Delete One",id:"delete-one",children:[]},{value:"Delete Many",id:"delete-many",children:[]}]},{value:"Foreign Keys",id:"foreign-keys",children:[{value:"Example",id:"example-12",children:[]}]},{value:"Relations",id:"relations",children:[{value:"Example",id:"example-13",children:[]}]}],b={rightToc:s};function m(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"@nestjs-query")," provides a common interface to use difference ORMs inorder to query and mutate your data."),Object(r.b)("p",null,"The following ORMs are supported out of the box."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"/nestjs-query/docs/persistence/typeorm/getting-started"}),"TypeOrm")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"/nestjs-query/docs/persistence/sequelize/getting-started"}),"Sequelize"))),Object(r.b)("p",null,"All examples assume the following entity."),Object(r.b)(i.a,{defaultValue:"typeorm",groupId:"orm",values:[{label:"TypeOrm",value:"typeorm"},{label:"Sequelize",value:"sequelize"}],mdxType:"Tabs"},Object(r.b)(l.a,{value:"typeorm",mdxType:"TabItem"},Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="todo-item.entity.ts"',title:'"todo-item.entity.ts"'}),"import { Column, CreateDateColumn, Entity, PrimaryGeneratedColumn, UpdateDateColumn } from 'typeorm';\n\n@Entity()\nexport class TodoItemEntity {\n  @PrimaryGeneratedColumn()\n  id!: string;\n\n  @Column()\n  title!: string;\n\n  @Column()\n  completed!: boolean;\n\n  @CreateDateColumn()\n  created!: Date;\n\n  @UpdateDateColumn()\n  updated!: Date;\n}\n"))),Object(r.b)(l.a,{value:"sequelize",mdxType:"TabItem"},Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="todo-item.entity.ts"',title:'"todo-item.entity.ts"'}),"import {\n  Table,\n  Column,\n  Model,\n  AllowNull,\n  CreatedAt,\n  UpdatedAt,\n  PrimaryKey,\n  AutoIncrement,\n} from 'sequelize-typescript';\n\n@Table\nexport class TodoItemEntity extends Model<TodoItemEntity> {\n  @PrimaryKey\n  @AutoIncrement\n  @Column\n  id!: number;\n\n  @Column\n  title!: string;\n\n  @AllowNull\n  @Column\n  description?: string;\n\n  @Column\n  completed!: boolean;\n\n  @CreatedAt\n  created!: Date;\n\n  @UpdatedAt\n  updated!: Date;\n}\n")))),Object(r.b)("h2",{id:"creating-a-service"},"Creating a Service"),Object(r.b)("h3",{id:"module"},"Module"),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"nestjs-query")," ",Object(r.b)("inlineCode",{parentName:"p"},"typeorm")," and ",Object(r.b)("inlineCode",{parentName:"p"},"sequelize")," packages provide a module that will add providers to inject auto-created ",Object(r.b)("inlineCode",{parentName:"p"},"QueryServices")," using the ",Object(r.b)("inlineCode",{parentName:"p"},"@InjectQueryService")," decorator."),Object(r.b)("p",null,"In order to use the decorator you will need to use the module that comes with the ",Object(r.b)("inlineCode",{parentName:"p"},"nestjs-query")," orm module providing it your entities that you want the services created for."),Object(r.b)(i.a,{defaultValue:"typeorm",groupId:"orm",values:[{label:"TypeOrm",value:"typeorm"},{label:"Sequelize",value:"sequelize"}],mdxType:"Tabs"},Object(r.b)(l.a,{value:"typeorm",mdxType:"TabItem"},Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="todo-item.module.ts" {8}',title:'"todo-item.module.ts"',"{8}":!0}),"import { NestjsQueryTypeOrmModule } from '@nestjs-query/query-typeorm';\nimport { Module } from '@nestjs/common';\nimport { TodoItemEntity } from './todo-item.entity';\nimport { TodoItemResolver } from './todo-item.resolver';\n\n@Module({\n  providers: [TodoItemResolver],\n  imports: [NestjsQueryTypeOrmModule.forFeature([TodoItemEntity])],\n})\nexport class TodoItemModule {}\n\n"))),Object(r.b)(l.a,{value:"sequelize",mdxType:"TabItem"},Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="todo-item.module.ts" {8}',title:'"todo-item.module.ts"',"{8}":!0}),"import { NestjsQuerySequelizeModule } from '@nestjs-query/query-sequelize';\nimport { Module } from '@nestjs/common';\nimport { TodoItemEntity } from './todo-item.entity';\nimport { TodoItemResolver } from './todo-item.resolver';\n\n@Module({\n  providers: [TodoItemResolver],\n  imports: [NestjsQuerySequelizeModule.forFeature([TodoItemEntity])],\n})\nexport class TodoItemModule {}\n")))),Object(r.b)("h3",{id:"decorator"},"Decorator"),Object(r.b)("p",null,"Once you have imported the correct module, use ",Object(r.b)("inlineCode",{parentName:"p"},"@InjectQueryService")," decorator to inject a ",Object(r.b)("inlineCode",{parentName:"p"},"QueryService")," into your class or resolver."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="todo-item.resolver.ts" {10}',title:'"todo-item.resolver.ts"',"{10}":!0}),"import { QueryService, InjectQueryService } from '@nestjs-query/core';\nimport { CRUDResolver } from '@nestjs-query/query-graphql';\nimport { Resolver } from '@nestjs/graphql';\nimport { TodoItemDTO } from './todo-item.dto';\nimport { TodoItemEntity } from './todo-item.entity';\n\n@Resolver(() => TodoItemDTO)\nexport class TodoItemResolver extends CRUDResolver(TodoItemDTO) {\n  constructor(\n    @InjectQueryService(TodoItemEntity) readonly service: QueryService<TodoItemEntity>\n  ) {\n    super(service);\n  }\n}\n")),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"The above resolver is an example of manually defining the resolver, if you use the ",Object(r.b)("inlineCode",{parentName:"p"},"NestjsQueryGraphQLModule")," you do not need to define a resolver."))),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"In the above example the DTO and entity are the same shape, if you have a case where they are different or have computed fields check out ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/nestjs-query/docs/concepts/assemblers"}),"Assemblers")," to understand how to convert to and from the DTO/Entity."))),Object(r.b)("h2",{id:"querying"},"Querying"),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"nestjs-query")," QueryService uses a common ",Object(r.b)("inlineCode",{parentName:"p"},"Query")," interface that allows you use a common type regardless of the persistence library in use."),Object(r.b)("p",null," To query for records from your service you can use the ",Object(r.b)("inlineCode",{parentName:"p"},"query")," method which will return a ",Object(r.b)("inlineCode",{parentName:"p"},"Promise")," of an array of entities. To read more about querying take a look at the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"../concepts/queries"}),"Queries Doc"),"."),Object(r.b)("h4",{id:"example"},"Example"),Object(r.b)("p",null,"Get all records"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const records = await this.service.query({});\n")),Object(r.b)("h3",{id:"filtering"},"Filtering"),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"filter")," option is translated to a ",Object(r.b)("inlineCode",{parentName:"p"},"WHERE")," clause."),Object(r.b)("h4",{id:"example-1"},"Example"),Object(r.b)("p",null,"To find all completed ",Object(r.b)("inlineCode",{parentName:"p"},"TodoItems")," by use can use the ",Object(r.b)("inlineCode",{parentName:"p"},"is")," operator."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const records = await this.service.query({\n   filter : {\n     completed: { is: true },\n   },\n});\n")),Object(r.b)("h3",{id:"sorting"},"Sorting"),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"sorting")," option is translated to a ",Object(r.b)("inlineCode",{parentName:"p"},"ORDER BY"),"."),Object(r.b)("h4",{id:"example-2"},"Example"),Object(r.b)("p",null,"Sorting records by ",Object(r.b)("inlineCode",{parentName:"p"},"completed")," and ",Object(r.b)("inlineCode",{parentName:"p"},"title"),"."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const records = await this.service.query({\n  sorting: [\n    {field: 'completed', direction: SortDirection.ASC},\n    {field: 'title', direction: SortDirection.DESC},\n  ],\n});\n")),Object(r.b)("h3",{id:"paging"},"Paging"),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"paging")," option is translated to ",Object(r.b)("inlineCode",{parentName:"p"},"LIMIT")," and ",Object(r.b)("inlineCode",{parentName:"p"},"OFFSET"),"."),Object(r.b)("h4",{id:"example-3"},"Example"),Object(r.b)("p",null,"Skip the first 20 records and return the next 10."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const records = await this.service.query({\n  paging: {limit: 10, offset: 20},\n});\n")),Object(r.b)("h3",{id:"find-by-id"},"Find By Id"),Object(r.b)("p",null,"To find a single record you can use the ",Object(r.b)("inlineCode",{parentName:"p"},"findById")," method."),Object(r.b)("h4",{id:"example-4"},"Example"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const records = await this.service.findById(1);\n")),Object(r.b)("h3",{id:"get-by-id"},"Get By Id"),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"getById")," method is the same as the ",Object(r.b)("inlineCode",{parentName:"p"},"findById")," with one key difference, it will throw an exception if the record is not found."),Object(r.b)("h4",{id:"example-5"},"Example"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"try {\n  const records = await this.service.getById(1);\n} catch (e) {\n  console.error('Unable to get record with id = 1');\n}\n")),Object(r.b)("h3",{id:"aggregating"},"Aggregating"),Object(r.b)("p",null,"To perform an ",Object(r.b)("inlineCode",{parentName:"p"},"aggregate")," query you can use the ",Object(r.b)("inlineCode",{parentName:"p"},"aggregate")," method which accepts a ",Object(r.b)("inlineCode",{parentName:"p"},"Filter")," and ",Object(r.b)("inlineCode",{parentName:"p"},"AggregateQuery"),"."),Object(r.b)("p",null,"Supported aggregates are ",Object(r.b)("inlineCode",{parentName:"p"},"count"),", 'sum', 'avg', ",Object(r.b)("inlineCode",{parentName:"p"},"min")," and ",Object(r.b)("inlineCode",{parentName:"p"},"max"),"."),Object(r.b)("p",null,"In this example we'll aggregate on all records."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const aggregateResponse = await this.service.aggregate({}, {\n    count: ['id'],\n    min: ['title'],\n    max: ['title']\n});\n")),Object(r.b)("p",null,"The response will look like the following"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"{\n  count: {\n    id: 10\n  },\n  min: {\n    title: 'Aggregate Todo Items'\n  },\n  min: {\n    title: 'Query Todo Items'\n  },\n}\n")),Object(r.b)("p",null,"In this example we'll aggregate on all completed TodoItems"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const aggregateResponse = await this.service.aggregate({ completed: { is: true } }, {\n    count: ['id'],\n    min: ['title'],\n    max: ['title']\n});\n")),Object(r.b)("h2",{id:"creating"},"Creating"),Object(r.b)("h3",{id:"create-one"},"Create One"),Object(r.b)("p",null,"To create a single record use the ",Object(r.b)("inlineCode",{parentName:"p"},"createOne")," method."),Object(r.b)("h4",{id:"example-6"},"Example"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const createdRecord = await this.service.createOne({\n  title: 'Foo',\n  completed: false,\n});\n")),Object(r.b)("h3",{id:"create-many"},"Create Many"),Object(r.b)("p",null,"To create multiple records use the ",Object(r.b)("inlineCode",{parentName:"p"},"createMany")," method."),Object(r.b)("h4",{id:"example-7"},"Example"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const createdRecords = await this.service.createMany([\n  { title: 'Foo', completed: false },\n  { title: 'Bar', completed: true },\n]);\n")),Object(r.b)("h2",{id:"updating"},"Updating"),Object(r.b)("h3",{id:"update-one"},"Update One"),Object(r.b)("p",null,"To update a single record use the ",Object(r.b)("inlineCode",{parentName:"p"},"updateOne")," method."),Object(r.b)("h4",{id:"example-8"},"Example"),Object(r.b)("p",null,"Updates the record with an id equal to 1 to completed."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const updatedRecord = await this.service.updateOne(1, { completed: true });\n")),Object(r.b)("h3",{id:"update-many"},"Update Many"),Object(r.b)("p",null,"To update multiple records use the ",Object(r.b)("inlineCode",{parentName:"p"},"updateMany")," method."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"NOTE")," This method returns a ",Object(r.b)("inlineCode",{parentName:"p"},"UpdateManyResponse")," which contains the updated record count."),Object(r.b)("h4",{id:"example-9"},"Example"),Object(r.b)("p",null,"Updates all ",Object(r.b)("inlineCode",{parentName:"p"},"TodoItemEntities")," to completed if their title ends in ",Object(r.b)("inlineCode",{parentName:"p"},"Bar")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const { updatedCount } = await this.service.updateMany(\n  {completed: true}, // update\n  {completed: {is: false}, title: {like: '%Bar'}} // filter\n);\n")),Object(r.b)("h2",{id:"deleting"},"Deleting"),Object(r.b)("h3",{id:"delete-one"},"Delete One"),Object(r.b)("p",null,"To delete a single record use the ",Object(r.b)("inlineCode",{parentName:"p"},"deleteOne")," method."),Object(r.b)("h4",{id:"example-10"},"Example"),Object(r.b)("p",null,"Delete the record with an id equal to 1."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const deletedRecord = await this.service.deleteOne(1);\n")),Object(r.b)("h3",{id:"delete-many"},"Delete Many"),Object(r.b)("p",null,"To delete multiple records use the ",Object(r.b)("inlineCode",{parentName:"p"},"deleteMany")," method."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"NOTE")," This method returns a ",Object(r.b)("inlineCode",{parentName:"p"},"DeleteManyResponse")," which contains the deleted record count."),Object(r.b)("h4",{id:"example-11"},"Example"),Object(r.b)("p",null,"Delete all ",Object(r.b)("inlineCode",{parentName:"p"},"TodoItemEntities")," older than ",Object(r.b)("inlineCode",{parentName:"p"},"Jan 1, 2019"),"."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"const { deletedCount } = await this.service.deleteMany(\n  { created: { lte: new Date('2019-1-1') } } // filter\n);\n")),Object(r.b)("h2",{id:"foreign-keys"},"Foreign Keys"),Object(r.b)("p",null,"It is a common use case to include a foreign key from your entity in your DTO."),Object(r.b)("p",null,"To do this you should add the foreign key to your entity as well as your DTO."),Object(r.b)("h3",{id:"example-12"},"Example"),Object(r.b)("p",null,"Assume TodoItems can have SubTasks we would set up our SubTaskEntity using the following"),Object(r.b)(i.a,{defaultValue:"typeorm",groupId:"orm",values:[{label:"TypeOrm",value:"typeorm"},{label:"Sequelize",value:"sequelize"}],mdxType:"Tabs"},Object(r.b)(l.a,{value:"typeorm",mdxType:"TabItem"},Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="sub-task.entity.ts"',title:'"sub-task.entity.ts"'}),"import {\n  Entity,\n  PrimaryGeneratedColumn,\n  Column,\n  CreateDateColumn,\n  UpdateDateColumn,\n  ObjectType,\n  ManyToOne,\n  JoinColumn,\n} from 'typeorm';\nimport { TodoItemEntity } from '../todo-item/todo-item.entity';\n\n@Entity({ name: 'sub_task' })\nexport class SubTaskEntity {\n  @PrimaryGeneratedColumn()\n  id!: number;\n\n  @Column()\n  title!: string;\n\n  @Column({ nullable: true })\n  description?: string;\n\n  @Column()\n  completed!: boolean;\n\n  // add the todoItemId to the model\n  @Column({ nullable: false, name: 'todo_item_id' })\n  todoItemId!: string;\n\n  @ManyToOne((): ObjectType<TodoItemEntity> => TodoItemEntity, (td) => td.subTasks, {\n    onDelete: 'CASCADE',\n    nullable: false,\n  })\n  // specify the join column we want to use.\n  @JoinColumn({ name: 'todo_item_id' })\n  todoItem!: TodoItemEntity;\n\n  @CreateDateColumn()\n  created!: Date;\n\n  @UpdateDateColumn()\n  updated!: Date;\n}\n"))),Object(r.b)(l.a,{value:"sequelize",mdxType:"TabItem"},Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="sub-task.entity.ts"',title:'"sub-task.entity.ts"'}),"import {\n  Table,\n  AllowNull,\n  Column,\n  ForeignKey,\n  BelongsTo,\n  CreatedAt,\n  UpdatedAt,\n  Model,\n  AutoIncrement,\n  PrimaryKey,\n} from 'sequelize-typescript';\nimport { TodoItemEntity } from '../todo-item/entity/todo-item.entity';\n\n@Table({})\nexport class SubTaskEntity extends Model<SubTaskEntity> {\n  @PrimaryKey\n  @AutoIncrement\n  @Column\n  id!: number;\n\n  @Column\n  title!: string;\n\n  @AllowNull\n  @Column\n  description?: string;\n\n  @Column\n  completed!: boolean;\n\n  @Column\n  @ForeignKey(() => TodoItemEntity)\n  todoItemId!: number;\n\n  @BelongsTo(() => TodoItemEntity)\n  todoItem!: TodoItemEntity;\n\n  @CreatedAt\n  created!: Date;\n\n  @UpdatedAt\n  updated!: Date;\n}\n")))),Object(r.b)("p",null,"Then we could add the ",Object(r.b)("inlineCode",{parentName:"p"},"todoItemId")," to the SubTaskDTO."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="sub-task.dto.ts" {24-26}',title:'"sub-task.dto.ts"',"{24-26}":!0}),"import { FilterableField } from '@nestjs-query/query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime } from '@nestjs/graphql';\n\n@ObjectType('SubTask')\nexport class SubTaskDTO {\n  @FilterableField(() => ID)\n  id!: number;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField({ nullable: true })\n  description?: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @FilterableField(() => GraphQLISODateTime)\n  created!: Date;\n\n  @FilterableField(() => GraphQLISODateTime)\n  updated!: Date;\n\n  // expose the todoItemId as a filterable field.\n  @FilterableField()\n  todoItemId!: string;\n}\n")),Object(r.b)("h2",{id:"relations"},"Relations"),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"This section only applies when you combine your DTO and entity"))),Object(r.b)("p",null,"When your DTO and entity are the same class and you have relations defined, you should not decorate your the relations in the DTO with ",Object(r.b)("inlineCode",{parentName:"p"},"@Field")," or ",Object(r.b)("inlineCode",{parentName:"p"},"@FilterableField"),"."),Object(r.b)("p",null,"Instead decorate the class with ",Object(r.b)("inlineCode",{parentName:"p"},"@Connection")," or ",Object(r.b)("inlineCode",{parentName:"p"},"@Relation"),"."),Object(r.b)("h3",{id:"example-13"},"Example"),Object(r.b)("p",null,"Assume you have the following subtask definition."),Object(r.b)(i.a,{defaultValue:"typeorm",groupId:"orm",values:[{label:"TypeOrm",value:"typeorm"},{label:"Sequelize",value:"sequelize"}],mdxType:"Tabs"},Object(r.b)(l.a,{value:"typeorm",mdxType:"TabItem"},Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="sub-task.ts"  {15,38-44}',title:'"sub-task.ts"',"":!0,"{15,38-44}":!0}),"import {\n  Entity,\n  PrimaryGeneratedColumn,\n  Column,\n  CreateDateColumn,\n  UpdateDateColumn,\n  ManyToOne,\n  JoinColumn,\n} from 'typeorm';\nimport { ObjectType, ID } from '@nestjs/graphql';\nimport { FilterableField, Relation } from '@nestjs-query/query-graphql';\nimport { TodoItem } from '../todo-item/todo-item';\n\n@ObjectType()\n@Relation('todoItem', () => TodoItem, { disableRemove: true })\n@Entity({ name: 'sub_task' })\nexport class SubTask {\n  @FilterableField(() => ID)\n  @PrimaryGeneratedColumn()\n  id!: number;\n\n  @FilterableField()\n  @Column()\n  title!: string;\n\n  @FilterableField()\n  @Column({ nullable: true })\n  description?: string;\n\n  @FilterableField()\n  @Column()\n  completed!: boolean;\n\n  @FilterableField()\n  @Column({ nullable: false, name: 'todo_item_id' })\n  todoItemId!: string;\n\n  // do not decorate with @Field\n  @ManyToOne(() => TodoItem, (td) => td.subTasks, {\n    onDelete: 'CASCADE',\n    nullable: false,\n  })\n  @JoinColumn({ name: 'todo_item_id' })\n  todoItem!: TodoItem;\n\n  @FilterableField()\n  @CreateDateColumn()\n  created!: Date;\n\n  @FilterableField()\n  @UpdateDateColumn()\n  updated!: Date;\n}\n"))),Object(r.b)(l.a,{value:"sequelize",mdxType:"TabItem"},Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="sub-task.ts" {18,45-47}',title:'"sub-task.ts"',"{18,45-47}":!0}),"import {\n  Table,\n  AllowNull,\n  Column,\n  ForeignKey,\n  BelongsTo,\n  CreatedAt,\n  UpdatedAt,\n  Model,\n  AutoIncrement,\n  PrimaryKey,\n} from 'sequelize-typescript';\nimport { FilterableField } from '@nestjs-query/query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime } from '@nestjs/graphql';\nimport { TodoItem } from '../todo-item/entity/todo-item';\n\n@ObjectType()\n@Relation('todoItem', () => TodoItem, { disableRemove: true })\n@Table\nexport class SubTask extends Model<SubTaskEntity> {\n  @FilterableField(() => ID)\n  @PrimaryKey\n  @AutoIncrement\n  @Column\n  id!: number;\n\n  @FilterableField()\n  @Column\n  title!: string;\n\n  @FilterableField({ nullable: true })\n  @AllowNull\n  @Column\n  description?: string;\n\n  @FilterableField()\n  @Column\n  completed!: boolean;\n\n  @FilterableField()\n  @Column\n  @ForeignKey(() => TodoItemEntity)\n  todoItemId!: number;\n\n  // do not decorate with @Field\n  @BelongsTo(() => TodoItem)\n  todoItem!: TodoItem;\n\n  @FilterableField(() => GraphQLISODateTime)\n  @CreatedAt\n  created!: Date;\n\n  @FilterableField(() => GraphQLISODateTime)\n  @UpdatedAt\n  updated!: Date;\n}\n")))),Object(r.b)("p",null,"Notice how the ",Object(r.b)("inlineCode",{parentName:"p"},"todoItem")," is not decorated with a field decorator, instead it is exposed through the ",Object(r.b)("inlineCode",{parentName:"p"},"@Relation")," decorator."))}m.isMDXComponent=!0},230:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return u}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var d=o.a.createContext({}),s=function(e){var t=o.a.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},b=function(e){var t=s(e.components);return o.a.createElement(d.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},p=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),b=s(n),p=a,u=b["".concat(i,".").concat(p)]||b[p]||m[p]||r;return n?o.a.createElement(u,l(l({ref:t},d),{},{components:n})):o.a.createElement(u,l({ref:t},d))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=p;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var d=2;d<r;d++)i[d]=n[d];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},231:function(e,t,n){"use strict";function a(e){var t,n,o="";if("string"==typeof e||"number"==typeof e)o+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(o&&(o+=" "),o+=n);else for(t in e)e[t]&&(o&&(o+=" "),o+=t);return o}t.a=function(){for(var e,t,n=0,o="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(o&&(o+=" "),o+=t);return o}},232:function(e,t,n){"use strict";var a=n(0);const o=Object(a.createContext)({tabGroupChoices:{},setTabGroupChoices:()=>{},isAnnouncementBarClosed:!1,closeAnnouncementBar:()=>{}});t.a=o},233:function(e,t,n){"use strict";var a=n(0),o=n(232);t.a=function(){return Object(a.useContext)(o.a)}},234:function(e,t,n){"use strict";var a=n(0),o=n.n(a),r=n(233),i=n(231),l=n(92),c=n.n(l);const d=37,s=39;t.a=function(e){const{block:t,children:n,defaultValue:l,values:b,groupId:m}=e,{tabGroupChoices:p,setTabGroupChoices:u}=Object(r.a)(),[O,j]=Object(a.useState)(l);if(null!=m){const e=p[m];null!=e&&e!==O&&b.some(t=>t.value===e)&&j(e)}const y=e=>{j(e),null!=m&&u(m,e)},g=[];return o.a.createElement("div",null,o.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(i.a)("tabs",{"tabs--block":t})},b.map(({value:e,label:t})=>o.a.createElement("li",{role:"tab",tabIndex:"0","aria-selected":O===e,className:Object(i.a)("tabs__item",c.a.tabItem,{"tabs__item--active":O===e}),key:e,ref:e=>g.push(e),onKeyDown:e=>((e,t,n)=>{switch(n.keyCode){case s:((e,t)=>{const n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()})(e,t);break;case d:((e,t)=>{const n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()})(e,t)}})(g,e.target,e),onFocus:()=>y(e),onClick:()=>y(e)},t))),o.a.createElement("div",{role:"tabpanel",className:"margin-vert--md"},a.Children.toArray(n).filter(e=>e.props.value===O)[0]))}},235:function(e,t,n){"use strict";var a=n(0),o=n.n(a);t.a=function(e){return o.a.createElement("div",null,e.children)}}}]);